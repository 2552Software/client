<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WebSockets Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script src="gauge.min.js"></script>
    <script src="Chart.bundle.js"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <ul class="nav nav-tabs justify-content-center" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Charts</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Configure</a>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                <div class="row">
                    <button onclick="animateGauges()">Animate</button>
                    <button onclick="stopGaugesAnimation()">Stop animation</button>
                    <div class="col-sm">
                        <canvas data-type="radial-gauge"
                                data-value="-20"
                                data-width="400"
                                data-height="400"
                                data-bar-width="10"
                                data-bar-shadow="5"
                                data-color-bar-progress="rgba(0,0,250,.75)"></canvas>

                    </div>
                    <div class="col-sm">
                        <canvas data-type="radial-gauge"
                                data-min-value="0"
                                data-max-value="360"
                                data-major-ticks="N,NE,E,SE,S,SW,W,NW,N"
                                data-minor-ticks="22"
                                data-ticks-angle="360"
                                data-start-angle="180"
                                data-stroke-ticks="false"
                                data-highlights="false"
                                data-color-plate="#33a"
                                data-color-major-ticks="#f5f5f5"
                                data-color-minor-ticks="#ddd"
                                data-color-numbers="#ccc"
                                data-color-needle="rgba(240, 128, 128, 1)"
                                data-color-needle-end="rgba(255, 160, 122, .9)"
                                data-value-box="true"
                                data-value-text-shadow="false"
                                data-color-circle-inner="#fff"
                                data-color-needle-circle-outer="#ccc"
                                data-needle-circle-size="15"
                                data-needle-circle-outer="false"
                                data-animation-rule="linear"
                                data-needle-type="line"
                                data-needle-start="75"
                                data-needle-end="99"
                                data-needle-width="3"
                                data-borders="true"
                                data-border-inner-width="0"
                                data-border-middle-width="0"
                                data-border-outer-width="10"
                                data-color-border-outer="#ccc"
                                data-color-border-outer-end="#ccc"
                                data-color-needle-shadow-down="#222"
                                data-border-shadow-width="0"
                                data-animation-target="plate"
                                data-units="ᵍ"
                                data-title="DIRECTION"
                                data-font-title-size="19"
                                data-color-title="#f5f5f5"
                                data-animation-duration="1500"
                                data-width="400"
                                data-height="400"
                                data-use-min-path="true"></canvas>

                    </div>
                    <div class="col-sm">
                    </div>
                </div>

            </div>
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <div style="width:75%;">
                    <canvas id="canvas"></canvas>
                </div>
            </div>
            <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                <div id="status">Connecting...</div>

                <ul id="messages"></ul>
                <form id="message-form" action="#" method="post">
                    <textarea id="message" placeholder="Write your message here..." required></textarea>
                    <button type="submit">Send Message</button>
                    <button type="button" id="close">Close Connection</button>
                    <button type="button" id="open">Open Connection</button>
                </form>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1">@</span>
                    </div>
                    <input type="text" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="basic-addon1">
                </div>

                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Recipient's username" aria-label="Recipient's username" aria-describedby="basic-addon2">
                    <div class="input-group-append">
                        <span class="input-group-text" id="basic-addon2">@example.com</span>
                    </div>
                </div>

                <label for="basic-url">Your vanity URL</label>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon3">https://example.com/users/</span>
                    </div>
                    <input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3">
                </div>

                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">$</span>
                    </div>
                    <input type="text" class="form-control" aria-label="Amount (to the nearest dollar)">
                    <div class="input-group-append">
                        <span class="input-group-text">.00</span>
                    </div>
                </div>

                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">With textarea</span>
                    </div>
                    <textarea class="form-control" aria-label="With textarea"></textarea>
                </div>
            </div>
        </div>
    </div>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script>
            if (!Array.prototype.forEach) {
                Array.prototype.forEach = function (cb) {
                    var i = 0, s = this.length;
                    for (; i < s; i++) {
                        cb && cb(this[i], i, this);
                    }
                }
            }
            document.fonts && document.fonts.forEach(function (font) {
                font.loaded.then(function () {
                    if (font.family.match(/Led/)) {
                        document.gauges.forEach(function (gauge) {
                            gauge.update();
                        });
                    }
                });
            });
            var timers = [];
            function animateGauges() {
                document.gauges.forEach(function (gauge) {
                    timers.push(setInterval(function () {
                        var min = gauge.options.minValue - 20;
                        var max = gauge.options.maxValue + 20;
                        gauge.value = min + Math.random() * (max - min);
                    }, gauge.animation.duration + 50));
                });
            }
            function stopGaugesAnimation() {
                timers.forEach(function (timer) {
                    clearInterval(timer);
                });
            }
        </script>
        <script>
            Math.seed = 6;
            Math.seededRandom = function (max, min) {
                max = max || 1;
                min = min || 0;

                Math.seed = (Math.seed * 9301 + 49297) % 233280;
                var rnd = Math.seed / 233280;

                return min + rnd * (max - min);
            }
            window.chartColors = {
                red: 'rgb(255, 99, 132)',
                orange: 'rgb(255, 159, 64)',
                yellow: 'rgb(255, 205, 86)',
                green: 'rgb(75, 192, 192)',
                blue: 'rgb(54, 162, 235)',
                purple: 'rgb(153, 102, 255)',
                grey: 'rgb(201, 203, 207)'
            };
            var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            var config = {
                type: 'line',
                data: {
                    labels: ["January", "February", "March", "April", "May", "June", "July"],
                    datasets: [{
                        label: "Wind History",
                        backgroundColor: window.chartColors.red,
                        borderColor: window.chartColors.red,
                        data: [
                            Math.round(Math.seededRandom()),
                            Math.round(Math.seededRandom()),
                            Math.round(Math.seededRandom()),
                            Math.round(Math.seededRandom()),
                            Math.round(Math.seededRandom()),
                            Math.round(Math.seededRandom())
                        ],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'FUMI Wind'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Time'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'KPH'
                            }
                        }]
                    }
                }
            };
            window.onload = function () {
                var ctx = document.getElementById("canvas").getContext("2d");
                window.myLine = new Chart(ctx, config);
            };
            document.getElementById('randomizeData').addEventListener('click', function () {
                config.data.datasets.forEach(function (dataset) {
                    dataset.data = dataset.data.map(function () {
                        return randomScalingFactor();
                    });
                });
                window.myLine.update();
            });
            var colorNames = Object.keys(window.chartColors);
            document.getElementById('addDataset').addEventListener('click', function () {
                var colorName = colorNames[config.data.datasets.length % colorNames.length];
                var newColor = window.chartColors[colorName];
                var newDataset = {
                    label: 'Dataset ' + config.data.datasets.length,
                    backgroundColor: newColor,
                    borderColor: newColor,
                    data: [],
                    fill: false
                };
                for (var index = 0; index < config.data.labels.length; ++index) {
                    newDataset.data.push(randomScalingFactor());
                }
                config.data.datasets.push(newDataset);
                window.myLine.update();
            });
            document.getElementById('addData').addEventListener('click', function () {
                if (config.data.datasets.length > 0) {
                    var month = MONTHS[config.data.labels.length % MONTHS.length];
                    config.data.labels.push(month);
                    config.data.datasets.forEach(function (dataset) {
                        dataset.data.push(randomScalingFactor());
                    });
                    window.myLine.update();
                }
            });
            document.getElementById('removeDataset').addEventListener('click', function () {
                config.data.datasets.splice(0, 1);
                window.myLine.update();
            });
            document.getElementById('removeData').addEventListener('click', function () {
                config.data.labels.splice(-1, 1); // remove the label first
                config.data.datasets.forEach(function (dataset, datasetIndex) {
                    dataset.data.pop();
                });
                window.myLine.update();
            });
        </script>
        <script>
            //$('.odometer').html(123) // with jQuery
            //http://blog.teamtreehouse.com/an-introduction-to-websockets
            // Get references to elements on the page.
            var form = document.getElementById('message-form');
            var messageField = document.getElementById('message');
            var messagesList = document.getElementById('messages');
            var socketStatus = document.getElementById('status');
            var closeBtn = document.getElementById('close');
            var openBtn = document.getElementById('open');
            // Create a new WebSocket. // ws://echo.websocket.org http://127.0.0.1:8000
            var socket = new WebSocket('ws://127.0.0.1:8000');
            // Show a connected message when the WebSocket is opened.
            socket.onopen = function (event) {
                socketStatus.innerHTML = 'Connected to: ' + event.currentTarget.url;
                socketStatus.className = 'open';
            };
            // Handle any errors that occur.
            socket.onerror = function (error) {
                console.log('WebSocket Error: ' + error);
            };

            //var odo = document.getElementByClass('.odometer');
            // Send a message when the form is submitted.
            form.onsubmit = function (e) {
                e.preventDefault();
                var msg = {
                    type: "message",
                    text: document.getElementById("message").value,
                    id: 1
                };
                socket.send(JSON.stringify(msg));
                // Retrieve the message from the textarea.
                //var message = messageField.value;

                // Send the message through the WebSocket.
                //socket.send(message);

                // Add the message to the messages list.
                messagesList.innerHTML += '<li class="sent"><span>Sent:</span>' + message +
                    '</li>';

                // Clear out the message field.
                messageField.value = '';

                return false;
            };

            // Close the WebSocket connection when the close button is clicked.
            closeBtn.onclick = function (e) {
                e.preventDefault();

                // Close the WebSocket.
                socket.close();

                return false;
            };
            openBtn.onclick = function (e) {
                e.preventDefault();

                return false;
            };
            // Show a disconnected message when the WebSocket is closed.
            socket.onclose = function (event) {
                socketStatus.innerHTML = 'Disconnected from WebSocket.';
                socketStatus.className = 'closed';
            };
            // Handle messages sent by the server.
            socket.onmessage = function (event) {
                console.info('data ', event.data);

                var message = event.data;
                messagesList.innerHTML += '<li class="received"><span>Received:</span>' +
                    message + '</li>';
            };
        </script>
</body>
</html>